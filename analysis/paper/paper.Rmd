---
title: "Assessing the impact of urban heating on tree growth in Berlin with open inventory and environmental data"
author:
  - Alexander G. Hurley$^{a *}$, Ingo Heinrich$^a$, ...
  - $^a$ *Geoforschungszentrum Potsdam, Section 4.3, Germany*
  - "* Corresponding author: hurley@gfz-potsdam.de"
date: "`r format(Sys.time(), '%d %B, %Y')`"
always_allow_html: true
output: 
    bookdown::html_document2:
      fig_caption: yes
      toc: true
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
    bookdown::pdf_document2:
      fig_caption: yes
      toc: yes
header-includes:
- \usepackage{amsmath}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage[normalem]{ulem}
bibliography: 
  - uhi_references.bib
  - 04_gfz_UHI.bib
  - 07_phenoTram.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  **This document outlines the rationale for an analysis of tree growth (potential) and its relationship with the Urban Heat Island (UHI) effect in Berlin using an extensive, publicly available data set. It introduces preliminary results and provides an outlook for up-coming and potential work.**
keywords: |
  Uferbaeume; Anlagenbaeume; Strassenbaeume; 
highlights: |
  We will see. 
---

<style>
body {
text-align: justify}
</style>

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE, cache = FALSE, include = FALSE}
knitr::opts_knit$set(root.dir = here::here(),
                     base.dir = here::here())

knitr::opts_chunk$set(
  fig.align = "center",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  # fig.path = "../figures/",
  fig.path = paste0(file.path(here::here(), "analysis", "figures"), "/"),
  dpi = 300
)


out_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")

pgbreak <- function() {
  if (grepl("docx", out_format)) {
    return("##### pagebreak")
  } else if (knitr::is_latex_output()) {
    return("\\newpage")
  }
}


library(drake)
library(kableExtra)
# library(ggplot2)
# library(patchwork)
```

# Introduction {#sec:intro}

The manifold ecological and societal benefits urban trees provide [e.g., @roy2012] depend critically on their health and performance. 
For instance, trees alter local energy budgets [@grimmond1996 ; @hertel2019] through shading and transpiration [@gillner2015;@endlicher2016], and therefore can reduce ambient temperatures, infrastructure power-consumption and (human) thermal discomfort  [e.g. @gulyas2006; @akbari2001; @mayer1987; @hoyano1988].
However, excess heat common for cities [i.e., Urban Heat Island, UHI, @oke1982], combined with other urban conditions, affects tree physiological functioning with outcomes ranging from enhanced growth to early senescence, branch die-back, and even mortality [e.g., @hilbert2019;@au2018;@gillner2014]. 
Thus, assessing the effect of increased temperatures on trees, as part of urban green infrastructure, is instrumental for understanding as well as adapting to current and expected conditions in this century [@ward2007], especially considering ever more urbanized societies  and the potential for UHI effects to compound with more frequent atmospheric drought [@roloff2009;@brune2016;@norton2015].


The UHI effect, i.e., the difference between urban and adjacent rural (air) temperatures, has been intensively studied for several decades [cf. @oke1982;@stewart2011].
It is typically related to the structure and density of urban land-use [@kuttler2015], which can be characterized through local climate zones, and modulated by physiographic and urban characteristics, such as vicinity to water bodies, predominant wind and street direction, etc. [@stewart2012]; yet, the physical basis for the excess heat in cities is to a large extent found in the altered surface energy balance as the proportional cover of vegetation decreases compared to rural (or reference) systems [@hertel2019; @oke1992].
In temperate climates, this results in strongest UHI magnitudes at night [cf. @fenner2014].
For example, Berlin features the most intense UHI in Germany due to its large extent and development intensity  with an average air temperature increase of around 5 K at night-times (2001-2010) with maxima of up to 11 K [@fenner2014] in urban $vs.$ rural areas.

Increased air temperatures due to UHIs can affect tree growth through altering several physiological processes across plant organs directly or indirectly [@dusenge2019].
Generally, reaction times at cellular level increase with temperature up to a maximum, after which a drop in enzymatic activity results in a species-dependent optimum curve  [@arcus2016; @parent2010]. 
In leaves this optimum response is reflected in the net assimilation rate of carbohydrates, as a balance of photosynthesis and respiration, with losses exceeding gains more rapidly with increasing temperatures [@long1991].
These responses vary between species [@tjoelker2001] as well as intra-specifically due to local acclimation, i.e., a shift of optimum temperature responses after prolonged exposure [@yamori2014], and threshold temperatures before tissue damage occurs [for review see @geange2021].
High temperatures in temperate areas are often coincident with low relative air humidity (i.e., large vapor pressure deficit), which in turn can decrease stomatal conductance governing the majority of gas exchange in leaves [@grossiord2020], and thus the capacity for photosynthesis.
Under prolonged stomatal closure (or decreased conductance) with high temperatures, trees may thus face decreased growth (in subsequent years) or even starvation as their carbohydrate reserves are depleted yet not replenished at sufficient rates [@mcdowell2008].
Furthermore, air (and soil temperatures) affect the initiation, speed and cessation of cambial activity, and thus radial growth throughout a growing season [e.g., see @begum2013; @rathgeber2016].
Radial growth is increasingly considered to be limited by wood formation dynamics and their relation with environmental drivers, rather than solely by photosynthetic activity [@korner2015].
In particular, the availability of soil water is critical for cell expansion [e.g., @peters2021a] and most likely limits radial growth before photosynthesis [@fatichi2014]; however, this water availability is again linked to local climate as higher temperatures drive evaporation and thus may contribute to the depletion of soil water storage, impeding growth.

<!-- Higher temperatures lead to more rapid reaction times at cellular level in the cambium , i.e., controlling incremental growth [@begum2013],  and during photosynthesis [@yamori2014], can extend leaf-on phases, and  may be associated with less cloudy conditions, indirectly increasing the availability of energy for photosynthesis. -->
<!-- However, if temperatures exceed photosynthetic optima, productivity may decline rapidly followed by (permanent) tissue damage in leaves. -->
<!-- As warmer air is typically drier, high temperatures can also lead to closure of stomata (major leaf gas exchange pathway) to prevent excessive loss of water to a "demanding" atmosphere.  -->
<!-- Additionally, high temperatures at night can increase respiration rates, leading to increased loss of carbohydrates. -->
<!-- Where high temperatures and dry air are compounded by atmospheric or soil drought, trees thus not only experience decreased growth, but also may face extensive tissue damage and ultimately starvation. -->
<!-- 	- Compounded by decreased Precip in cities?! Moser reischl? -->


Urban trees show a tendency for enhanced growth rates and/or productivity compared to rural conspecifics [e.g., @briber2015; @obrien2012], which is typically attributed to increased temperatures [@jia2018; @pretzsch2017], yet feature a broad range of effect sizes and signs (i.e., reduced growth) specific to species and location.
@zhao2016 showed that productivity rates, as a proxy for growth, increased within urban clusters as urbanization intensifies using remotely sensed vegetation indices.
Further, @moser-reischl2019a identified positive associations between air temperature and radial growth for two species (total of 20 individuals) commonly selected by urban planners (*Tilia  cordata* MilL., *Rubinia pseudoacacia*) in Munich.
<!-- [@briber2015; @obrien2012] â€¦ generally increased growth -->
Contrastingly,  @gillner2014 highlight decreased growth for *Acer* species  (*A. platanoides* and *pseudoplatanus*), *Platanus x hispanica* and *Quercus rubra* with higher summer temperatures of the preceding year, especially when compounded with drought, in another German metropolis (Dresden). 
@quigley2004 identified absolute growth potential decreased for species between rural and urban conspecifics, yet assessments were
<!-- lacked spatially-explicit effect size estimates across the urban-rural space and  -->
limited to comparatively small sample sizes per group ($n_{total}~=~230$ divided in 15 species, 3 groups and 2 locations).
@pretzsch2017 inferred enhanced growth in recent decades and across urban locations spanning several latitudes, including Berlin - however, only 145 individuals of one species (*T. cordata*) were assessed there.
As mentioned previously, climate-growth relationships can vary substantially between species, and in fact, @quigley2004 and @pretzsch2017 report contrasting results regarding average tree diameter, i.e. smaller or larger for urban $vs.$ rural trees of same age.
Similarly, for Berlin, @dahlhausen2018, identified enhanced growth in highly urbanized environments (using basal area increments of a large sample of 252 trees) for *T. cordata*, the most abundant tree of the city, which they attributed to the UHI effect, while intermediate development intensity was adverse for tree growth.
These differences in growth trends may result from contrasting species-specific responses to increased temperatures, but are indeed affected by other (time-varying) factors and stochastic processes, such as water availability, pollution and road-salt loading, structural impedance by infrastructure, or management, etc. [@rhoades1999; @quigley2004; @randrup2001; @pauleit2002].
Further, the variability in responses may require that assessments are developed for a specific region, because well-understood tree characteristics [e.g., see @brune2016;@roloff2009], could be strongly modulated predictably due to management, planting practices, or other environmental controls; for example, if drought hardiness is related to extensive root networks, restricted soil volumes available to street trees will render a species more vulnerable to water stress. 
<!-- **expand on location-specific factors that can affect growth** -->

<!-- This can hinder the extrapolation from individual sampling sites toward predicting effect across entire urban areas and tree stocks, especially where studies rely on labor-intensive methods which are limited logistically by sampling effort, reducing sample sizes, and species as well as spatial coverage. -->
<!-- This is exacerbated by a lack of co-located environmental variables (i.e. measured in situ) at pertinent spatial scales, for instance, as noted by @wohlfahrt2019 for air temperature and tree leaf phenology, which may lead to incorrect inferences and interpretations for the role of climate change on growth/productivity when applying space-for-time substitutions. -->
Space-for-time substitutions and time series comparisons between and within locations are a common approach (cf. studies above) to generate inferences in observational (rather than treatment-control) studies, where manipulations are costly or logistically unfeasible due to time and/or financial constraints.
However, they require  accounting for confounding factors specific to trees' environments, such as street characteristics, development intensity, available soil volume, etc.
While several of the aforementioned studies applied these approaches to quantify temperature and excess heat on growth, they typically compare trees grouped using qualitative or summary descriptors of sampling sites, disregarding the spatio-temporal variability in location-specific factors noted above.
This can hinder the extrapolation from individual sampling sites toward predicting effects across entire urban areas and tree stocks, especially when studies rely on labor-intensive methods, which are limited logistically by sampling effort, reducing sample sizes and coverage of species and space.
This can be  exacerbated by a lack of co-located environmental variables (i.e. measured in situ) at pertinent spatial scales, for instance, as noted by @wohlfahrt2019 for air temperature and tree leaf phenology, which may lead to incorrect inferences and interpretations for the role of climate change on growth/productivity when applying space-for-time substitutions.
It is thus likely that the varying and even contrasting growth responses observed for urban trees across and within studies are at least modulated by some confounding factors, making the attribution to a single driver, such as excess heat, more difficult and possibly less accurate.



These limitations could be overcome by developing extensive dendroecological surveys (i.e., incremental growth) and/or inventories (single or repeat) combined with pertinent environmental data with adequate spatio-temporal coverage and resolution. 
Inventories are logistically and financially more feasible, and - together with environmental data - are increasingly more available [e.g. @ossola2020] due to open data policies and their value being recognized across domains for urban greenspace planning and adaptation [@hansen2019; @monteiro2020].
Berlin, as one of the greenest cities in Europe, provides an openly accessible tree inventory, with spatio-temporal environmental data sets relevant to tree growth. 
It features a total of 650000 individuals covering 94 genera and at least 600 species and/or cultivars, listing information on location, stem diameter (at breast height; $DBH$), and stem height, amongst other variables, for the majority of street and park trees.
For this study, our objective was to assess the impact of excess urban heat, i.e. the UHI effect, on tree growth ($DBH$) using this openly available inventory data set, complemented by additional open data sources as well as incremental growth data from tree cores. 
The assessment relied on flexible statistical models that could capture species and location-specific responses to heat and other urban factors.
Specifically, we aimed to (1) assess heat exposure of the most abundant species; (2) determine the impact of (excess) heat on stem growth across tree age classes with a space-for-time substitution; (3) highlight the role of location-specific environmental factors in mediating temperature responses.
<!-- This work constitutes a case study for Berlin, the results are a valuable contribution toward Berlin's current and future management of its tree stock.  -->
Our results are a contribution toward Berlin's current and future management of its tree stock and may help drive adaptation to climate change.
Despite being a case study for a single city, we believe our work may provide a flexible approach for other cities with available or growing inventories, as well as ancillary environmental data, and may also inform the use of other planning tools, such as species-climate matrices [@roloff2009] regarding temperature sensitivity. 
<!-- This is because the high temporal and spatial variability of controls on growth, and thus variability in responses, require that assessments are developed for a specific region, because well-understood tree characteristics [e.g., see @brune2016;@roloff2009], could be strongly modulated  in predicable ways at a given location or time due to management, planting practices, or other environmental controls; for example, if drought hardiness is related to extensive root networks, small soil volumes available to street trees could render a species vulnerable to water stress.  -->
<!-- As such, the approach can also serve as a framework for base-line assessments for other cities with available or growing inventory and ancillary data [cite something on tree diversity in tree stocks, management, etc.], and also inform species-climate matrices regarding temperature sensitivity -->
<!-- Berlin features the most intense Urban Heat Island (UHI) in Germany due to its large extent and development intensity [@kuttler2015], with temperature increases of up to $12~K$ during day-time and $6~K$ on average for night-times [2001-2010, @fenner2014] in urban $vs.$ rural areas. -->
<!-- Consequently, urban green (infrastructure) systems are subjected to increased heat more frequently, potentially affecting their process dynamics - either positively or adversely.  -->
<!-- Their performance and health, however, is closely tied to local energy budgets [@grimmond1996 ; @hertel2019], which in turn are decisive for controlling human wellbeing [e.g. @maras2016], amongst other factors. -->
<!-- Assessing the effect of increased temperatures on green infrastructure, as part of the urban landscape, is therefore instrumental for understanding, and ultimately mitigating, the potential impact of future warming on increasingly urban societies [@norton2015].  -->
<!-- Trees, in particular, provide shading as well as transpirative cooling in their vicinity [@gillner2015;@oke1982;@endlicher2016], and therefore can reduce ambient temperatures, infrastructure power-consumption and (human) thermal discomfort  [e.g. @gulyas2006; @akbari2001; @mayer1987; @hoyano1988]; -->
<!-- simultaneously, they provide numerous other environmental, cultural and psychological services and/or benefits [see @tzoulas2007 for review]. -->
<!-- Further, recent tree growth dynamics as a proxy for on-going and future warming may provide an additional line of evidence to support the growing knowledge base on future climate-vegetation dynamics [@zhao2016] and may aid in mitigation and adaptation efforts [@pretzsch2017;@brune2016]. -->
<!-- Trees and green infrastructure in urban areas show a tendency for enhanced growth rates and/or productivity compared to rural counterparts [@jia2018; @pretzsch2017], yet feature a broad range of effect size ranges and, in some cases, signs specific to species and locality. -->
<!-- @zhao2016 showed that growth rates increased within urban clusters as urbanization intensifies using remotely sensed vegetation indices. -->
<!-- Similarly, for Berlin, @dahlhausen2018, identified positive growth modulation in highly urbanized environments (using growth increments) for *Tilia cordata* Mill, the most abundant tree of the city, which they attributed to the UHI effect, while intermediate development intensity showed indications of being least favorable for tree growth. -->
<!--  For Berlin, @dahlhausen2018, showed divergent patterns for young and old trees dependent on urban development intensity for *Tilia cordata* Mill, the most abundant tree of the city, but overall reported an increased growth rate which they attributed to the UHI effect. -->
<!-- Further, @moser-reischl2019a identified positive associations between air temperature and radial growth for two species commonly selected by urban planners (*T. cordata*, *Rubinia pseudoacacia*) in Munich. -->
<!-- By contrast, @gillner2014 highlight decreased growth for *Acer* species  (*A. platanoides* and *pseudoplatanus*), *Platanus x hispanica* and *Quercus rubra* with higher summer temperatures of the preceding year, especially when compounded with drought, in another German metropolis (Dresden).  -->
<!-- Differences in growth trends may result from contrasting species-specific characteristics, but are indeed affected by other processes and factors, such as water availability, pollution and road-salt loading, structural impedance through infrastructure or management, etc. [@rhoades1999; @quigley2004; @randrup2001; @pauleit2002]. -->
<!-- Under climate change, atmospheric drought will likely be compounded with high temperatures - and intensified UHIs - more frequently, adding further stress to current urban disturbance regimes [@roloff2009]. -->
<!-- Conditions affecting tree growth can vary greatly within urban areas or regions, and need to be accounted for when establishing relationships with pertinent drivers, such as the UHI effect. -->
<!-- This typically complicates the extrapolation from individual sampling sites toward predicting effect sizes across entire urban areas and tree stocks. -->
<!-- This is especially the case for studies reliant on labour-intensive methods which are limited logistically by sampling effort, reducing sample sizes, as well as species and spatial coverage. -->
<!-- While multiple (locally) important species have been assessed along urban and UHI gradients reflecting a range of conditions, studies reliant on labour-intensive methods are limited logistically by sampling effort, reducing sample size and coverage (i.e. genera and/or species, and space). -->
<!--  However, urban tree growth in urban settings is affected by various processes, which  --> 
<!--  However, growth in urban settings is affected by other processes and factors, such as water availability, pollution and road-salt loading, structural impedance through infrastructure or management, etc. [@rhoades1999; @quigley2004; @randrup2001; @pauleit2002]. --> 
<!-- While multiple (locally) important species have been assessed along urban and UHI gradients reflecting a range of conditions, studies reliant on labour-intensive methods are limited logistically by sampling effort, reducing sample size and coverage (i.e. genera and/or species, and space). --> 
<!-- This typically hinders the extrapolation from individual sampling sites toward prediction of effect sizes across entire urban areas and tree stocks.  --> 
<!--  Therefore, studies reliant on labor-intensive sampling, must carefully address confounding factors to ensure effect sizes are estimated adequately. -->


<!--  Detailed, but spatially-limited dendroecological analyses of climate-growth relationships in Berlin for key species can be enhanced by inferring growth modulation from a large data set in excess of 650000 individuals provided by the Berlin Senate Administration (Senatsverwaltung). -->

<!-- To complement (existing) detailed dendroecological analyses of climate-growth relationships in Berlin for key species, we propose inferring growth modulation from a large data set in excess of 650000 individuals covering 94 genera and at least 600 species and/or cultivars provided by the Berlin Senate Administration (Senatsverwaltung). -->
<!-- This data set contains information on location, species, trunk diameter (at breast height; $DBH$; see Tab.$~$\@ref(tab:tab-tree-overview)), and height, amongst other variables for the majority of street and park trees. -->


```{r tab-tree-overview, eval = FALSE, include = FALSE}
drake::loadd(overview_table)


caption_ov <- "Available records by category in entire data set (n), and those with age and $DBH$ entries (n$_{full}$)."
caption_ov_short <- "Available records in Berlin tree database."


if (grepl("docx", out_format) ||
    knitr::is_latex_output() ) {
  table_ov <- overview_table %>% 
  knitr::kable(booktabs = TRUE,
              
             caption = caption_ov,
             caption.short = caption_ov_short,
             format = "latex",
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) 
  
} else {
table_ov <- overview_table %>% 
  knitr::kable(booktabs = TRUE,
               format = "html",
               
             caption = caption_ov,
             caption.short = caption_ov_short,
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) 
}


 table_ov %>% 
  kableExtra::kable_styling(full_width = TRUE, 
                            font_size = 11,
                            latex_options = c("hold_position")) %>% 
  kableExtra::row_spec(0, bold = TRUE, font_size = 12) 

```

<!-- In a space-for-time substitution, growth of individual species can be assessed across the entire city of Berlin, and related to effects of the UHI, while accounting for other location-specific factors, such as street characteristics, development intensity, available soil volume, etc. -->
<!-- Comparable applications are found, for example, in @quigley2004 and @pretzsch2017. -->
<!-- The former  inferred absolute growth potential for species across successional groups (early, mid, late stage), and between rural and urban conspecifics, yet lacked spatially-explicit effect size estimates across the urban-rural space and was limited to comparatively small sample sizes per group ($n_{total}~=~230$ divided in 15 species, 3 groups and 2 locations). -->
<!-- @pretzsch2017 applied linear hierarchical models to infer growth modulation on annual basis for different time periods and urban $vs.$ rural locations while accounting for stand-level variability; -->
<!-- however, for Berlin only 145 individuals of one species (*T. cordata*) were assessed. -->
<!-- As mentioned previously, climate-growth relationships can vary substantially between species, and in fact, @quigley2004 and @pretzsch2017 report contrasting results regarding average tree diameter, i.e. smaller or larger for urban $vs.$ rural trees of same age. -->
<!-- Consequently, this variability of effect sizes and directions calls for a more comprehensive assessment across species and with greater spatial coverage throughout Berlin. -->

<!-- **We therefore propose applying a statistical model that is fully spatially explicit, while also allowing to account for the nested nature of the data set (e.g. streets and districts) as well as other pertinent factors using hierarchical, generalized additive models (see Section$~$\@ref(sec:methods)). -->
<!-- As a result, the absolute growth potential of a species can be inferred given, for example, a specific location, age or UHI magnitude.  -->
<!-- Further, the impact of UHI loading can be predicted for a single species across all of Berlin as a continuous surface.** -->
<!-- The inclusion of independent, tree-level growth data, however, is paramount as it allows:   -->
<!-- 1) validating the publicly-available Senate dataset ($DBH$) while providing a more reliable estimate of tree age,   -->
<!-- 2) applying the model with annual basal area as a response (enabling incorporating effects of varying climate/UHI intensities over time), and   -->
<!-- 3) comparing $DBH$ (Senate data) and basal area-derived models for a subset of locations and species, increasing confidence in Berlin-wide predictions.  -->
<!-- We acknolwedge results from [@gregg2003], which indicated impeded growth adjacent to intense urban clusters, rather than enhancement within them. -->


# Methods {#sec:methods}

## Study area

Berlin is one of the largest metropolitan areas in Central Europe (892$~km^2$) with a population of approximately 3.6 million, and a maximum extent of 38$~km$ in North-South and 45$~km$ in East-West directions. 
It is located in North-Eastern Germany, and lies in the temperate zone with warm-humid climate (Dfb) according to the updated KÃ¶ppen-Geiger classification [@beck2018], with mean annual temperature of approximately 10$^\circ C$ and precipitation of 575$~mm$ (Tempelhof weather station, DWD).
Berlin features low relief (approximately 30$~m$ to 60$~m$ with 120$~m$ at solitary peaks), and is centered around a glacial outwash valley (sands, gravel), bordered by two plateaus consisting of glacial till and clay in the North-East and South, as well as sands in the South-West.
The city provides extensive public green space covering around 30$~\%$ of its area [@suvkberlin2019], with an extensive urban forest of nearly 700000 publicly-managed trees along streets, in parks and in riparian areas.
<!-- It has a pronounced urban heat island, owing to its high degree of built-up and sealed surfaces, with air temperatures up to 12$^\circ C$ higher in urban compared to adjacent rural areas [@fenner2014]. -->




(ref:study-area) Berlin's generalized land-use derived from @suvkberlin2019 and location within the European context (inset).

```{r fig-study-area, fig.cap="(ref:study-area)",fig.width = 12, fig.height = 14, out.width="50%"}




knitr::include_graphics(here::here("analysis/figures/map_00_studyarea.png"))

  

# plot_count_map

# plot(1:10)
```


## General approach: space-for-time analyses

<!-- Species-specifc growth responses in relation across Berlin were assessed in relat -->
We modeled the stem diameter ($DBH$) of Berlinâ€™s ten most abundant species (contingent to ancillary data availability) in relationship to their location, age, a measure of excess heat [UrbClim by @deridder2015; Berlin Environmental Atlas models; LandSat-derived surface urban heat island by @chakraborty2019], and additional environmental covariates with generalized additive models (GAMs, see Section$~$\@ref(sec:stat-gam) for details).
Covariates were extracted at 150 and 300$~m$ to infer the impact of reference scale of the urban fabric on tree growth. 
From all tested models the most suitable (i.e., parsimonious with highest explanatory) was employed for further analyses.


## Data sources {#sec:dsources}

<!-- Berlinâ€™s open data provided tree inventories (species, age, location, diameter which were processed with a bespoke software datacleanr by Hurley et al., submitted), planting bed area, estimates of soil nutrient availability, and adjacent building height. With WUDAPT local climate zones (Demuzere et al., 2019), these were used to determine treesâ€™ growing conditions (locally, or within a radius of 150 m / 300 m).  -->

An overview of data used for models, including sources, types, and application, is provided in Table$~$\@ref(tab:tab-dsources), with detailed descriptions in the following subsections.


```{r dsources-prep, include=FALSE}

options(knitr.kable.NA = "")


dsources_path <- "analysis/data/tables/data_sources.xlsx"
dsources <- readxl::read_excel(dsources_path, na = "NA")
dsources$Accessed <- format(dsources$Accessed, "%b '%y")

```

```{r tab-dsources, eval = TRUE}

caption <- "Data description used for maps/visualizations and analyses. Resolution and radius are provided in $m$, the latter is the buffer in which data was averaged around each trees. A zero-radius refers to a point extraction from categorical and location specific data."
caption_ov_short <- "Data descriptions"

dsource <- dsources[-which(dsources$File == 'Wintertime_gridded_UHI_data.zip'), ]


dsources <- dsources %>%
    dplyr::mutate(Category = forcats::fct_relevel(Category, 'trees', 'temperature', 'landuse', 'ancillary', 'gov')) %>% 
    arrange(Category) %>%
  dplyr::select(Name = `Name-eng`, Accessed, Type, Unit = `Unit-latex`, Resolution, Radius, Source = `Source-short`, Reference = TextRef) %>%
  # dplyr::filter(Name != "UHI Berlin",
  dplyr::filter(Name != "Park Trees",
                Name != "Riparian Trees") 


if (grepl("docx", out_format) ||
    knitr::is_latex_output() ) {
  table_ds <- dsources %>% 
  knitr::kable(booktabs = TRUE,
              
             caption = caption,
             caption.short = caption,
             format = "latex",
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) %>% 
      kableExtra::landscape()
  
} else {
table_ds <- dsources %>% 
  knitr::kable(booktabs = TRUE,
               format = "html",
               
             caption = caption,
             caption.short = caption_ov_short,
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) 
}


table_ds %>% 
  kableExtra::kable_styling(full_width = TRUE, 
                            font_size = 11,
                            latex_options = c("hold_position")) %>% 
  kableExtra::row_spec(0, bold = TRUE, font_size = 12) 


# dsources %>%
#   
#   knitr::kable(caption = caption, escape = FALSE) %>%
#   kableExtra::kable_styling(full_width = TRUE,
#                             bootstrap_options = c("striped", "hover", "condensed", "responsive"))


# flextable::set_flextable_defaults(padding.left = 0)
# 
# dsources %>%
#   dplyr::select(`Name-eng`, Accessed, Type, Source, TextRef) %>%
#   flextable::flextable() %>%
#   flextable::autofit()


```


### Street trees  

Berlinâ€™s open data provided tree inventories including species, age, location, and circumference which was transformed into diameter.
Note that only street trees in urban, not rural areas or within green spaces, were considered here, but individual trees may grow along streets adjacent to green spaces and parks of varying sizes.
Implausible observations, likely from erroneous data entry, were removed.
Additional manual data processing for quality control was done with a bespoke software  `datacleanr` by Hurley *et al*. (submitted), where obvious outliers or clearly interpolated data were removed; the latter was deemed necessary, as several observations in multiple city districts were derived by linear relationships (i.e., straight-line), which do not capture the ontogenic growth dynamics of trees, and leave no variation related to variables other than age.
All of these operations were recorded, and can be viewed and reproduced via the supplementary code.
Lastly, observations with unlikely diameter-age combinations were identified via the residuals of a generalized linear model between diameter and age with a Gamma log-link distribution: if individual residuals exceeded seven times the median absolute deviation of all residuals, they were removed.
The median absolute deviation (MAD) is comparable to the inter-quartile range, yet more robust to outliers:

$$MAD = median(|X_i - median(X)|) $$
This approach is considered conservative (see supplementary information), yet all analyses were carried forward with the unfiltered and filtered data - no considerable differences were found, thus subsequent sections are based on the filtered data.
<!-- which were processed with the bespoke software datacleanr by Hurley et al., submitted), -->
<!-- Characteristics of street trees and their respective environments were collated from the city's tree inventory, as well as various elements of the Berlin Environment Atlas, which are openly available via https://daten.berlin.de and curated by the city's government. -->
<!-- The data used from the inventory includes species, location, age, and diameter at breast height (dbh). -->
Table$~$\@ref(tab:tab-age) shows the binned distribution of genera across age classes.
Final samples applied in models were smaller, following the availability of ancillary data for a given observation, and limited to a maximum age of 125 years to increase confidence in reported values, and ultimately model estimates.


```{r tab-age}

drake::loadd(age_tables)

age_tables <- age_tables %>% 
  dplyr::arrange(desc(n_total))
colnames(age_tables)[c(1,7,8, 9)] <- c("Genera", "150+", "Total (n)", "Missing (n)") 

age_tables <- dplyr::bind_rows(age_tables[age_tables$Genera!="Other",],
                        age_tables[age_tables$Genera=="Other",])

  
add_row <- as.data.frame(matrix(c(NA, colSums(age_tables[,-1])), nrow = 1))
add_row[1,1] <- "Marg. Totals"
colnames(add_row) <- colnames(age_tables)

age_tables <- dplyr::bind_rows(age_tables,
                    add_row)


caption_trees <- "Binned age-distribution for genera in Berlin data set, and entries missing age information. "
caption_trees_short <- "Binned age-distribution for genera in Berlin data set."


if (grepl("docx", out_format) ||
    knitr::is_latex_output() ) {
  table_dat_req_kable <- age_tables %>% 
  knitr::kable(booktabs = TRUE,
               format = "latex",
             caption = caption_trees,
             caption.short = caption_trees_short
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             ) %>% 
  kableExtra::row_spec(13, hline_after = TRUE) 
  
} else {
table_dat_req_kable <- age_tables %>% 
  knitr::kable(booktabs = TRUE,
               format = "html",
              caption = caption_trees,
             caption.short = caption_trees_short
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             ) %>% 
  kableExtra::row_spec(13, extra_css = "border-bottom: 1px solid")

# %>% 
#   kableExtra::kable_styling(full_width = TRUE, 
#                             font_size = 10) %>% 
#   kableExtra::column_spec(1, italic = TRUE) %>%
#   kableExtra::row_spec(0, bold = TRUE) %>% 
#     kableExtra::row_spec(13, hline_after = TRUE) 

}


   table_dat_req_kable %>% 
  kableExtra::kable_styling(full_width = TRUE, 
                            font_size = 11) %>% 
  kableExtra::column_spec(1, italic = TRUE) %>%  
  kableExtra::row_spec(0, italic = FALSE, bold = TRUE, font_size = 12) 

```


### Temperature/UHI data

Temperature and UHI data were summarized temporally either by the provider or manually to provide a characteristic representation of heat loading during summer at different times (morning, afternoon/day, night), from which tree averages (radius of 150$~m$) were calculated.
Two data sets of urban air and one surface temperature were tested as explanatory variables in GAM models.
The air temperatures from the Berlin environmental atlas (EnvAt) are model outputs that are representations of typical summer conditions at 0400, 1400 and 2200 hours; these data are provided at city block basis (spatial polygons), from which weighted averages were extracted.
UrbClim air temperatures are hourly model outputs [100$~m$ resolution, @deridder2015] based on ERA5 re-analyses data (ECMWF) for which observations from the hottest month  available (June, 2011) were averaged to hours equivalent to Berlin Environmental Atlas (referred to as Berlin EnvAt) data by using a window of $\pm~1~$hour (i.e., 0300 to 0500, etc.).
Subsequently, a land-use and land-cover mask (CORINE; European Union, Copernicus Land Monitoring Service 2018, European Environment Agency) was used to define urban and rural/forested areas.
Using this mask was deemed reasonable as Berlin's built-up area has not changed markedly over the past 50 years, i.e., about 52 to 61$\%$ [@mohamed2017]. 
The urban heat loading was then calculated as 
$$UHI_{x,y} = T_{Air_{2m}~x,y} - \overline{T_{Air_{2m}~Rural}},$$
where $T$ is temperature ($^\circ C$) $x$ and $y$ define an urban grid cell.
The LandSat-derived surface UHI data set by @chakraborty2019 (referred to as LandSat) estimates its measure in a similar fashion and the reader is referred to the detailed description therein; note this data set provides day and night-time averaged UHI estimates at 500$~m$ resolution, which were extracted for the hottest summer in this record (2007).



### Ancillary environmental data

Following the general approach described above, four ancillary covariates next to a temperature measure were employed in models; these were chosen due to their availability at high spatial resolution and coverage, and/or because their influence on growth was previously identified in literature or their likely impact could be deduced using ecophysiological principles.
We included planting bed area and the sum of exchangeable basic cation as a proxy for soil nutrient availability (point extractions), as well as the proportional coverage of local climate zone 6 (LCZ6; open mid-rise, see @demuzere2019 and @stewart2012 for details) and adjacent building height (spatial averages).
The latter was chosen as an increase reflects a transition away from densely urbanized areas and had the highest coverage for the processed tree inventory.  




<!-- surface area of tree planting beds ("Baumscheibe"), as well as general characteristics of the urban environment like building height. -->
<!-- It also includes spatially-explicit model outputs for local climate simulations representative of typical conditions, such as air temperature (2 m) on a 2015 summer's day at different hours (0400, 1400, 2200).  -->
<!-- These model outputs were preferred over *in situ* measurements as **more representative based on averaged conditions, physiologically more relevant than surface urban heat island products**. -->
<!-- These outputs are available at city block or planning unit level, and were used as a proxy for the general temperature distribution influenced by urbanization across the investigated growth period across the previous 80 years (see section X for details). -->
<!-- This was deemed reasonable as Berlin's built-up area has not changed markedly over the past 50 years, i.e., about 52 to 61$\%$ [@mohamed2017].  -->
<!-- Further insight into the role of the urban environment was assessed by including local climate zone classes derived by WUDAPT. -->
<!-- These describe the proportion of urban area with a specific cover, such as dense high rises, sealed surfaces, etc.  -->
<!-- For this study, the LCZ 6, representing dense mid-rise built up cover was used as a proxy for the degree of urbanization, and is the most frequent LCZ for Berlin [@fenner2017] (found ref in . -->
<!-- Use percent sealed surface instead? -->




## Dendrochronological sampling

To contextualize tree growth patterns between age groups derived from Berlin's inventory data, we drew upon a recently established data set from Schneider *et al.* (in review), who sampled several common tree species across a rural-urban gradient. 
For our purposes, we grouped trees sampled in parks, green spaces and along streets into a single urban category, and focused analyses on these.
Two to three cores were extracted at breast height from each tree.
These were then prepared using standard dendro-ecological methods (i.e., mounting, sanding, measuring), and cross-dated with TSAP-Win\textsuperscript{TM} and COFECHA [@holmes1986], producing mean tree series of incremental growth.
Additionally, cambial age of each increment was established by counting years from the inner most ring at the pith ($a = 0$) outward; on tangentially bored cores, missing rings to the pith were estimated.


```{r tab-dendro-sites}

drake::loadd(series_long)
drake::loadd(species_lookup)

sampling_site_overview <-     series_long %>% 
        dplyr::filter(grepl("urban", x = site_type)) %>% 
        dplyr::select(sample_location, species, tree_id) %>% 
        dplyr::group_by(sample_location, species) %>%
        dplyr::summarize(tree_id = unique(tree_id)) %>% 
        # mutate(site_type = gsub("[-].*$", "", site_type)) %>% 
        dplyr::tally() %>% 
    dplyr::mutate(sample_location = stringr::str_replace(sample_location, "[-][a-zA-ZÃ¤]+$", "") %>% 
               stringr::str_replace(pattern = "-StEi", ""))


spec_matched <- species_lookup$Species[match(sampling_site_overview$species, species_lookup$Code)]

sampling_site_overview$species_long <- spec_matched

sampling_site_overview <- sampling_site_overview %>% 
    dplyr::select(Location = sample_location, Species = species_long, n)



caption <- "Overview of urban sampling locations and respective tree species coverage. Individual trees were sampled two or tree times to obtain a mean-tree ring width series."
caption_ov_short <- caption




if (grepl("docx", out_format) ||
    knitr::is_latex_output() ) {
  table_ds <- sampling_site_overview %>% 
  knitr::kable(booktabs = TRUE,
              
             caption = caption,
             caption.short = caption,
             format = "latex",
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) 
  
} else {
table_ds <- sampling_site_overview %>% 
  knitr::kable(booktabs = TRUE,
               format = "html",
               
             caption = caption,
             caption.short = caption_ov_short,
             # col.names = c("Subject/Relevance",
             #              "Desc.",
             #              "Type",
             #              "Obsv. (n)",
             #              "Resolution (m)",
             #              "Source")
             escape = FALSE) 
}


table_ds %>% 
  kableExtra::kable_styling(full_width = TRUE, 
                            font_size = 11,
                            latex_options = c("hold_position")) %>% 
  kableExtra::row_spec(0, bold = TRUE, font_size = 12) 




    

```



## Statistical Analyses {#sec:stat-gam}

### GAMs

We applied hierarchical generalized additive models (GAM) to estimate the relationship of several covariates with stem diamater growth ($DBH$).
GAMs, as an extension of generalized linear models [@wood2017], allow modeling response variables as parametric and non-parametric combinations of smoothed explanatory covariates, and can assume non-normal response distributions.
These smooths are constructed by summation of base functions of varying complexity and form, analogous to scatterplot smoothing [@hastie2017], which provides a high degree of flexibility, ideal for fitting ecosystem dynamics which are rarely linear [@pedersen2019], or correctly represented with deterministic functional forms (e.g. quadratic equations). 
In general, a GAM can be written as:

\begin{equation}
E (Y)~=~g^{-1}\left( \beta_0 + \sum_{i = 1}^{n} f_i (x_i) \right),
(\#eq:gam-general)
\end{equation}

and

\begin{equation}
y~=~E (Y) + \epsilon,
(\#eq:gam-expectation)
\end{equation}

where $Y$ is taken from an appropriate distribution and corresponding link function $g$, $\beta_0$ is the intercept and $f_i$ represents a smooth function of a predictor [@pedersen2019], and $\epsilon \sim \mathcal{N}(0, \sigma ^2)$. 
Nested data structures (e.g., city districts) can be accounted for by introducing random effects, while spatial dependence between observations can be accounted for by constructing smoothing functions with, for instance, northings and eastings [cf. @wood2017].
All models were implemented in `R` [@rcoreteam2021] using functions available in the package `mgcv` [@wood2017].


### Dendrochronological analyses

We assessed trends in annual growth dynamics of urban trees across the 20$^{th}$ century for 1920-1960 and 1961-2001 [similar grouping as  @pretzsch2017 and @dahlhausen2018] with a hierarchical GAM implemented in `mgcv::gamm()` to leverage auto-correlation structures made available through the package `nlme` [@pinheiro2021].
Annual growth was modeled as:


$$ g(\Delta r_i) =  f(year_i) + f_j(cambial~age_i)  + c_{i,j} + \tau_{i,k} + e_i $$
where $g()$ is a log-link for $\Delta r \sim Gamma$, $\Delta r$ is the annual radial increment for observation $i$. 
A global temporal (by year) and time-dependent ($j$, $\leq 1960$ or $>1960$) trend in cambial age were implemented with thin plate regression splines (default smoothing function in `mgcv`); $c_j$ is a time-group dependent intercept, while $tau$ represents a matrix of random effect coefficients for $k$ species to account for differences in growth patterns, and $e_i = \phi e_{iâˆ’1} + \epsilon_i$.
A $3^{rd}$-order autocorrelation-moving average (ARMA) correlation structure was applied (i.e., $\phi(3,1)$) to account for the dependency of $\Delta r$ across years for each tree, as is frequently the case for tree growth [e.g., see @Fritts1989]; the detailed implementation for this model is given in the supplemental material code.
$\Delta r$ was then derived for a range of cambial ages, and averaged for both time groups, allowing a comparison of recent to earlier growth.
We acknowledge that tree cores obtained at breast height do not represent absolute tree age.
However, here they serve as a proxy for growth between young ($>1960$) and older individuals to contextualize growth patterns inferred from the larger-scale tree inventory.


### Stem diameter model development and selection

The diameter ($DBH$) of the ten most abundant species were modeled using GAMs as follows:

\begin{align}

g(DBH_i) &=  f_j(age_i) + f_j(temp_{t,i}, age_i) + f(covariate_i) + c_{i,j} + \tau_{i,k} + \epsilon_i \\ 

g(DBH_i) &= f_j(age_i) + f_j(temp_{t,i}, age_i) + f(covariate_i) + c_{i,j} + \tau_{i,k} + \epsilon_i  \\

g(DBH_i) &= f_j(age_i) + f_j(temp_{t,i}, age_i) + c_{i,j} + \tau_{i,k} + \epsilon_i  \\

g(DBH_i) &= f_j(age_i) +  f(covariate_i) + c_{i,j} + \tau_{i,k} + \epsilon_i  \\

g(DBH_i) &= f_j(age_i) +  c_{i,j} + \tau_{i,k} + \epsilon_i \\

\end{align}

where $g()$ is a log-link for $DBH \sim Gamma$, and $i$, $j$ are indices for observations and species, respectively, and $t$ refers to an (excess) heat measure from UrbClim, Berlin EnvAt or LandSat at different times (morning, afternoon/day, night; cf. Section$~$\@ref(sec:dsources)); $c$ is a species-dependent intercept, while $tau$ represents a matrix of random effect coefficients for $k$ districts to account for differing management regimes across the city.
Models were implemented with `mgcv::bam()` [@wood2017a;@li2020a] for a dramatic increase computational efficiency, allowing for rapid model development/comparison.
All models above were also tested with a global spatial smooth $f(utmx_i,utmy_i)$ using Gaussian process smooth [cf. p. 242 in @wood2017] to account for the spatial structure of observations, which reduced auto-correlation of model residuals considerably (see supplemental information).
**what's the impact of remaining auto correlation? inflated errors, larger coefficients?**
The functions $f_j$ are for species-specific smooths [i.e., with individual smoothness penalties and functional shapes as detailed by @pedersen2019]; the interaction between temperature interaction and age were implemented as tensor smooths [@wood2006] to account for the different variable scales (i.e., units).
Readers are referred to the detailed implementation in the supplemental material code.
The covariates for planting bed area and soil nutrient availability were log transformed to account for their skewed distribution, improving the estimation of coefficients for their respective basis functions.

Considering all combinations of (excess) heat measures and covariates (with point, as well as 150/300$~m$ extractions), a total of `r nrow(drake::readd(bam_dbh_filtered))` models were applied.
We selected the model with the highest explanatory power, based on residual deviance and observed vs. predicted fit, with comparatively largest sample size for final analyses.
From this model we derived age and species dependent $DBH$ averages across a temperature measure from predicted values in 5-year age groups starting at 30, 45, 60, 75, 90.

As the spatial extent and coverage varied between temperature and ancillary data, more complex models (and specifically those including planting bed area and LandSat temperatures) typically also had fewer total observations, which prevented a direct comparison with information-based model selection criteria, such as Aikake's.
For this reason, simpler model structures were preferred (i.e., few terms, interactions and restricted number of basis functions), reducing the potential for choosing over-fitted models.
Future research may focus on collecting additional data (e.g., increasing the coverage on planting bed area) and subsequently deriving species-specific smooths for ancillary environmental covariates.
We chose to carry out the analysis in its current form rather than on considerably smaller but comparable sample sizes across models, to identify the strongest relationships in the existing data.
This allowed us to highlight the utility of the approach *per se* and for Berlin in particular.



# Results {#sec:results}


<!-- Tree locations are clustered and structured based on their category, i.e. riparian, street and park trees (Fig.$~$\@ref(fig:fig-tree-overview-map)). -->
<!-- Planting in space and time shows species-specific patterns (by districts), often related to major events, such as the start and end of armed and/or political conflict. -->




<!-- ```{r fig-bar-tree, fig.cap="A plot of random numbers",fig.width = 15, fig.height = 8, out.width="100%", include=FALSE, eval=FALSE} -->

<!-- readd(plot_tree_sums_bar) -->

<!-- ``` -->


```{r fig-tree-overview-map, fig.cap="Individual tree locations for three categories available in Berlin Senate urban tree data set. Note, that for each category 7000 observations were subsampled from the available pool to facilitate visualization.",fig.width = 15, fig.height = 8, out.width="100%", include=TRUE, eval=TRUE}

# loadd(full_data_set_clean)
# loadd(plot_overview_map)
# print(class(full_data_set_clean))


knitr::include_graphics(here::here("analysis/figures/map_01_overview.png"))

# readd(plot_overview_map) + 
#      +
#     labs(caption = NULL)

# plot_overview_map

```


```{r fig-tree-count-map, fig.cap="Gridded counts for the 11 most frequent genera, as well as *Pinus* and remaining genera. Note, that counts are standardized to unity for individual genera.",fig.width = 12, fig.height = 14, out.width="100%"}




knitr::include_graphics(here::here("analysis/figures/map_02_tree_sums_standardized.png"))

  

# plot_count_map

# plot(1:10)
```

The distribution of the UHI effect is highly irregular and clustered in space (Fig.$~$\@ref(fig:fig-uhi-map)), and also shows variability through time (data not shown, refer to the [urban heat island explorer](https://yceo.users.earthengine.app/view/uhimap)).

(ref:chakraborty2019) [@chakraborty2019]


```{r fig-uhi-map, fig.cap="Estimate of UHI intensity based on the algorithm in (ref:chakraborty2019), comparing urban with rural pixels within the greater metropolitan cluster. Presented values are averaged over the summer of 2007.",fig.width = 12, fig.height = 14, out.width="50%"}




knitr::include_graphics(here::here("analysis/figures/map_03_uhi.png"))

  

# plot_count_map

# plot(1:10)
```


The exposure to increased heat-loading of individual genera (and consequently species) is highly uneven throughout the city (Fig.$~$\@ref(fig:fig-density)).
Street and park trees of most genera are clustered in urban areas with intermediate to high UHI loading, while riparian trees, and some street and park trees of other genera tend to be spread more evenly across Berlin's UHI range.


```{r fig-density, fig.cap="Empirical density distribution of all individuals within the presented genera along the UHI continuum. UHI intensities were extracted for each tree location, and the distribution hence represents the first detailed overview of the exposure of Berlin's trees to urban heat loading. The black line is the density across all three categories. Insets show corresponding tree totals.",fig.width = 12, fig.height = 12, out.width="100%"}
knitr::include_graphics(here::here("analysis/figures/plot_02_genus_UHI_dens.png"))



# plot_count_map

# plot(1:10)
```

**Note, that results below are preliminary and should be considered as a template for future outputs, rather than used for inference.**
The effect of UHI loading on absolute growth potential varies between genera and species (Fig.$~$\@ref(fig:fig-lmestat)).
Most notably, *Quercus*, the 3rd-most frequent genera, shows decreased absolute growth with increasing UHI loading,
while the most frequent genera, *Tilia*, features contrasting relationships between species.
The estimated effect sizes presented here are linear.
However, temperature may exert a non-linear control on absolute growth and, hence, applying a  method able to capture such dynamics may result in somewhat different effect sizes / behavior.
Additionally, if temperatures increase in the future under climate warming, any non-linear effects may become more enhanced, stressing the need for a more flexible model fit and structure (i.e. using GAMM over linear models-).


```{r fig-lmestat, fig.cap="Impact of UHI loading on tree diameter (\\(DBH\\)), accounting for age and inter-specific differences from the linear mixed model (via random slopes and intercepts). Line-ranges are standard errors of predicted effect sizes (i.e. slopes). Differences between street and park trees are considerable for some species, and may be due to local clustering and/or spatial under-representation across the UHI continuum. Further investigations need to address the degree of spatial autocorrelation and account for it where required in linear mixed models, and with smoothing interactions in a GAMM implementation.",fig.width = 20, fig.height = 12, out.width="100%"}
knitr::include_graphics(here::here("analysis/figures/plot_03_ranef_species_dbh_uhi.png"))
# plot_count_map

# plot(1:10)
```


# Discussion

1. Temperature, environmental and urban controls on tree growth  
      
	+ Intra specific differences
	  + management
	  + root vs. canopy (huber value?)
	  +  accelerated recent growth
	  + comparison young vs. old -> increased CO2, perhaps limitation of space for time,
	     as lower conductance under high CO2 may result in more water savings (check WUE
	     in old vs. young trees? future direction).[@dusenge2019] [@mccarthy2011]
	+ Sensitive trees in hot spots
	+ Temporal dynamics  
	+ Validity and limitations  
	
	[@bussotti2014]
	
	
	
	
2. Implications:  
  + Policy / planning:  
    - tree species
	  - Increase temporal coverage and accuracy  
		- which trees to prioritize for measurement campaigns  
		- Supplement species matrix etc. with these analyses  
  + Open data important --> drives innovation

# Outlook

We seek to build upon and improve the current analysis by: 

- validating the database with independent observations
- incorporating more pertinent covariates as dependent variables in the linear mixed model  
- testing multiple model structures with formal model selection procedures
- checking model residuals for spatial auto-correlation and accounting for it where necessary to ensure unbiased estimates of effect sizes
- repeating the above with a hierarchical GAM (i.e. GAMM) to allow for:  
  * estimating continuous prediction surfaces for UHI impacts on individual species' growth (similar to results in Figure$~$\@ref(fig:fig-lmestat)) under recent conditions
  * estimating absolute, species-specific growth potential under increased temperatures and UHI loading under climate change, ideally based on climate simulations (otherwise step-wise increases based on RCP scenarios) for the key species. Note, that  complications presented by 'out-of-sample' predictions will be addressed.
  * assess potential age-dependent UHI impacts on individual species.  
  * repeating the above (GAMM) with total and incremental basal area as responses  
  

<!-- # Acknowledgements -->

<!-- <!-- The following line inserts a page break  --> 
<!-- `r pgbreak()` -->

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

`r pgbreak()`

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
