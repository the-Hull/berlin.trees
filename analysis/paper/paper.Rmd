---
title: "Species-specific effects of the Urban Heat Island on tree growth across Berlin"
author:
  - Alexander G. Hurley$^{a *}$, Ingo Heinrich$^a$
  - $^a$ *Geoforschungszentrum Potsdam, Section 4.3, Germany*
  - "* Corresponding author: hurley@gfz-potsdam.de"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
    bookdown::html_document2:
      fig_caption: yes
      toc: yes
    bookdown::pdf_document2:
      fig_caption: yes
      toc: yes
bibliography: uhi_references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  **This document serves as a brief overview and outline** .
keywords: |
  Uferbaeume; Anlagenbaeume; Strassenbaeume; 
highlights: |
  We will see. 
---



<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE, cache = FALSE, include = FALSE}
knitr::opts_knit$set(root.dir = here::here(),
                     base.dir = here::here())

knitr::opts_chunk$set(
  fig.align = "center",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  # fig.path = "../figures/",
  fig.path = paste0(file.path(here::here(), "analysis", "figures"), "/"),
  dpi = 300
)


out_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")

pgbreak <- function() {
  if (grepl("docx", out_format)) {
    return("##### pagebreak")
  } else if (knitr::is_latex_output()) {
    return("\\newpage")
  }
}


library(drake)
# library(ggplot2)
# library(patchwork)
```

# Introduction

Berlin features the most intense Urban Heat Island (UHI) in Germany due to its large extent and development intensity [@kuttler2015], with temperature increases of up to $12~K$ during day-time and $6~K$ on average for night-times [2001-2010, @fenner2014] in urban $vs.$ rural areas.
Consequently, urban green (infrastructure) systems are subjected to increased heat more frequently, potentially affecting their process dynamics - either positively or adversely. 
Their performance and health, however, is closely tied to local energy budgets [@grimmond1996 ; @hertel2019], which in turn are decisive for controlling human wellbeing [e.g. @maras2016], amongst other factors.
Assessing the effect of increased temperatures on green infrastructure, as part of the urban landscape, is therefore instrumental for understanding, and ultimately mitigating, the potential impact of future warming on increasingly urban societies [@norton2015]. 


Trees, in particular, provide shading as well as transpirative cooling in their vicinity [@gillner2015;@oke1982;@endlicher2016], and therefore can reduce ambient temperatures, infrastructure power-consumption and (human) thermal discomfort  [e.g. @gulyas2006; @akbari2001; @mayer1987; @hoyano1988];
simultaneously, they provide numerous other environmental, cultural and psychological services and/or benefits [see @tzoulas2007 for review].
Further, recent tree growth dynamics as a proxy for on-going and future warming may provide an additional line of evidence to support the growing knowledge base on future climate-vegetation dynamics [@zhao2016] and may aid in mitigation and adaptation efforts [@pretzsch2017;@brune2016].


Trees and green infrastructure in urban areas show a tendency for enhanced growth rates and/or productivity compared to rural counterparts [@jia2018; @pretzsch2017], yet feature a broad range of effect size ranges and, in some cases, signs specific to species and locality.
@zhao2016 showed that growth rates increased within urban clusters as urbanization intensifies using remotely sensed vegetation indices.
Similarly, for Berlin, @dahlhausen2018, identified positive growth modulation in highly urbanized environments for *Tilia cordata* Mill (using growth increments), the most abundant tree of the city, which they attributed to the UHI effect, while intermediate development intensity showed indications of being least favorable for tree growth.
<!-- For Berlin, @dahlhausen2018, showed divergent patterns for young and old trees dependent on urban development intensity for *Tilia cordata* Mill, the most abundant tree of the city, but overall reported an increased growth rate which they attributed to the UHI effect. -->
Further, @moser-reischl2019a identified positive associations between air temperature and radial growth for two species commonly selected by urban planners (*T. cordata*, *Rubinia pseudoacacia*) in Munich.
By contrast, @gillner2014 highlight decreased growth for *Acer* species  (*A. platanoides* and *pseudoplatanus*), *Platanus x hispanica* and *Quercus rubra* with higher summer temperatures of the preceding year, especially when compounded with drought, in another German metropolis (Dresden). 
Differences in growth trends may result from contrasting intrinsic inter- and intra-specific characteristics, but are indeed affected by other processes and factors, such as water availability, pollution and road-salt loading, structural impedance through infrastructure or management, etc. [@rhoades1999; @quigley2004; @randrup2001; @pauleit2002].
Under climate change, atmospheric drought will likely be compounded with high temperatures - and intensified UHIs - more frequently, adding further stress to current urban disturbance regimes [@roloff2009].


Conditions affecting tree growth can vary greatly within urban areas or regions, and need to be accounted for when establishing relationships with pertinent drivers, such as the UHI effect.
This typically complicates the extrapolation from individual sampling sites toward predicting effect sizes across entire urban areas and tree stocks.
This is especially the case for studies reliant on labour-intensive methods which are limited logistically by sampling effort, reducing sample sizes, as well as species and spatial coverage.
<!-- While multiple (locally) important species have been assessed along urban and UHI gradients reflecting a range of conditions, studies reliant on labour-intensive methods are limited logistically by sampling effort, reducing sample size and coverage (i.e. genera and/or species, and space). -->
<!-- However, urban tree growth in urban settings is affected by various processes, which  -->
<!-- However, growth in urban settings is affected by other processes and factors, such as water availability, pollution and road-salt loading, structural impedance through infrastructure or management, etc. [@rhoades1999; @quigley2004; @randrup2001; @pauleit2002]. -->
<!-- While multiple (locally) important species have been assessed along urban and UHI gradients reflecting a range of conditions, studies reliant on labour-intensive methods are limited logistically by sampling effort, reducing sample size and coverage (i.e. genera and/or species, and space). -->
<!-- This typically hinders the extrapolation from individual sampling sites toward prediction of effect sizes across entire urban areas and tree stocks.  -->
<!-- Therefore, studies reliant on labor-intensive sampling, must carefully address confounding factors to ensure effect sizes are estimated adequately. -->
To complement detailed dendroecological analyses of climate-growth relationships in Berlin for key species, we propose inferring growth modulation from a large data set in excess of 650000 individuals provided by the Berlin Senate Administration (Senatsverwaltung). 
This data set contains information on location, species, trunk diameter (at breast height; $DBH$), and height, amongst other variables for street and park trees.
In a space-for-time substitution, growth of individual species can be assessed across the entire cite of Berlin, and related to effects of the UHI, while accounting for other location-specific factors, such as street characteristics, development intensity, available soil volume, etc.
Similar applications are found in @quigley2004, who inferred absolute growth potential for species across successional groups, and between rural and urban species, yet lacked spatially-explicit effect size estimates or predictions of maximum potential.
Similarly, @pretzsch2017 applied linear hierarchical models to infer growth modulation for different cities, time periods and locations (urban $vs.$ rural).
By contrast, we propose applying a statistical model that is spatially explicit, while also allowing to account for the nested nature of the data set (e.g. streets and districts) as well as other pertinent factors (hierarchical, generalized additive model, see Section$~$\@ref(sec:methods)).
This also allows to infer the absolute growth potential of species given, for example, a specific location, age or UHI magnitude.




We acknolwedge results from [@gregg2003], which indicated impeded growth adjacent to intense urban clusters, rather than enhancement within them.



# Proposed methods and data requirements 
\label{sec:methods}

The proposed statistical method is from the class of hierarchical, generalized additive models (GAM, or GAMM for mixed models/hierarchical models).
In these models combinations of continuous and categorical predictor variables can be summed to estimate a response. 
In particular, continuous variables that are linear, as well as non-linearly related to the response can be represented by applying a transfer function, typically termed "smoothing function" [@wood2017]; these are constructed using a number of base functions of varying complexity and form, which provides a high degree of flexibility, ideal for fitting ecosystem dynamics which are rarely linear [@pedersen2019], or correctly represented with deterministic functional forms (e.g. quadratic equations).



# Preliminary results

Some results



<!-- ```{r fig-bar-tree, fig.cap="A plot of random numbers",fig.width = 15, fig.height = 8, out.width="100%", include=FALSE, eval=FALSE} -->

<!-- readd(plot_tree_sums_bar) -->

<!-- ``` -->


```{r fig-tree-overview-map, fig.cap="A plot of random numbers",fig.width = 15, fig.height = 8, out.width="100%", include=TRUE, eval=TRUE}

# loadd(full_data_set_clean)
# loadd(plot_overview_map)
# print(class(full_data_set_clean))


knitr::include_graphics(here::here("analysis/figures/map_01_overview.png"))

# readd(plot_overview_map) + 
#      +
#     labs(caption = NULL)

# plot_overview_map

```


```{r fig-tree-count-map, fig.cap="A plot of random numbers",fig.width = 12, fig.height = 14, out.width="100%"}




knitr::include_graphics(here::here("analysis/figures/map_02_tree_sums_standardized.png"))

  

# plot_count_map

# plot(1:10)
```


```{r fig-uhi-map, fig.cap="A plot of random numbers",fig.width = 12, fig.height = 14, out.width="50%"}




knitr::include_graphics(here::here("analysis/figures/map_03_uhi.png"))

  

# plot_count_map

# plot(1:10)
```



```{r fig-density, fig.cap="A plot of random numbers",fig.width = 12, fig.height = 12, out.width="100%"}
knitr::include_graphics(here::here("analysis/figures/plot_02_genus_UHI_dens.png"))



# plot_count_map

# plot(1:10)
```





```{r fig-lmestat, fig.cap="A plot of random numbers",fig.width = 20, fig.height = 12, out.width="100%"}
knitr::include_graphics(here::here("analysis/figures/plot_03_ranef_species_dbh_uhi.png"))
# plot_count_map

# plot(1:10)
```



Figure \@ref(fig:lmestat) shows how we can have a caption and cross-reference for a plot

# Outlook

# Acknowledgements

<!-- The following line inserts a page break  -->
`r pgbreak()`

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

`r pgbreak()`

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
